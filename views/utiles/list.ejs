
<%- include('../includes/head.ejs') %>

    <nav>
        <div class="nav-wrapper">
          <a href="#" class="brand-logo">Tiendita</a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="/comprar">COMPRAR</a></li>
            <li><a href="/utiles/new">Registrar nuevo articulo</a></li>
            <li><a href="/user/logout">Cerrar sesion</a></li>
          </ul>
        </div>
    </nav>

<h1>Un acertijo</h1>
<p id="acertijo">
  
</p>
<script>
  const acertijo = () => {
        
          fetch('https://riddles-api.vercel.app/random', {
              method: 'GET',
              headers: {
              'Content-Type': 'application/json',
              }
          }).then(result => {
              return result.json(); //Regresa otra promesa
          }).then(data => {
              //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
              console.log(data.riddle);
            let html = '';
            html += data.riddle;
       
            document.getElementById('acertijo').innerHTML = html;
          }).catch(err => {
              console.log(err);
          });

      }
      acertijo();
</script>

<h1>Articulos Escolares</h1>

<div class="input-field ">
  <i class="material-icons prefix">search</i>
  <textarea id="buscar" class="materialize-textarea"></textarea>
  <label for="buscar">Nombre del articulo</label>
</div>

<div id="resultados"></div>
  <% if (utiles.length > 0) { %>
    <div class="row">
        <% for (let r of utiles) { %>
            <div class="col s12 m4 l3">
                <%- include('card.ejs', {utiles: r}) %>
            </div>
        <% } %>
    </div>
  <% } else { %>
    <h3>No hay articulos registrados.</h3>
  <% } %>

  <% if (ultimo_articulo != '') { %>
    <p>El último articulo registrado fue: <%= ultimo_articulo %></p>
  <% } %>
</div>

<script>
  const accion_asincrona = () => {
        
          let valor_busqueda = document.getElementById('buscar').value;
          /*
          fetch('ruta',{objeto con peticion}).then(()=>{}).catch(()=>{});
          */

          //función que manda la petición asíncrona
          fetch('/utiles/buscar/' + valor_busqueda, {
              method: 'GET',
              headers: {
              'Content-Type': 'application/json',
              }
          }).then(result => {
              return result.json(); //Regresa otra promesa
          }).then(data => {
              //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
              console.log(data);
            let html = '';
            if (data.length > 0) { 
                html += '<div class="row">';
                    for (let utiles of data) { 
                        html += '<div class="col s12 m4 l3">';
                        html += '<div class="card">';
                        html += '<div class="card-image waves-effect waves-block waves-light">';
                        html += '<img class="activator" src="'+ utiles.imagen + '">';
                        html += '</div>';
                        html += '<div class="card-content">';
                        html += '<span class="card-title activator grey-text text-darken-4">' + utiles.nombre + '<i class="material-icons right">more_vert</i></span>';
                        html += '<p><a href="/utiles/edit/' +  utiles.id + '"><i class="tiny material-icons">edit</i> Editar</a></p>';
                        html += '</div>';
                        html += '<div class="card-reveal">';
                        html += '<span class="card-title grey-text text-darken-4">' + utiles.nombre + '<i class="material-icons right">close</i></span>';
                        html += '<p>' + utiles.descripcion + '</p>';
                        html += '</div>';
                        html += '</div>';
                        html += '</div>';
                    } 
                html += '</div>';
            } else { 
                html += '<h3>No hay utiles registrados.</h3>';
            } 
            document.getElementById('resultados').innerHTML = html;
          }).catch(err => {
              console.log(err);
          });

      }
      document.getElementById('buscar').onkeyup = accion_asincrona;
</script>

<%- include('../includes/foot.ejs') %>